trigger:
- develop

pool:
  vmImage: ubuntu-latest

stages:
- stage: BuildApps
  jobs:
  - job: BuildHasherApp
    displayName: Building Hasher Application
    steps:
    - task: UseRubyVersion@0
      inputs:
        versionSpec: '>= 2.7'
    - task: CmdLine@2
      inputs:
          script: |
            gem install bundler
            bundle install --retry=3 --jobs=4
            bundle exec rake
          workingDirectory: 'app/hasher/'

  - job: BuildWebuiApp
    displayName: Building WebUI Application
    steps:
    - task: Gradle@2
      inputs:
        gradleWrapperFile: 'app/webui/gradlew'
        workingDirectory: 'app/webui/'
        tasks: 'build'
        publishJUnitResults: false
        javaHomeOption: 'JDKVersion'
        jdkVersionOption: '1.8'
        gradleOptions: '-Xmx3072m'
        sonarQubeRunAnalysis: false
        spotBugsAnalysis: false

  - job: BuildWorkerApp
    displayName: Building Worker Application
    steps:
      - task: UsePythonVersion@0
        inputs:
          versionSpec: '3.8'
          addToPath: true
          architecture: 'x64'
      - task: CmdLine@2
        inputs:
          script: |
            python -m pip install --upgrade pip
            pip install pipenv
            pipenv --python 3.8
            pipenv lock && \
            PIP_USER=1 \
            PIP_IGNORE_INSTALLED=1 \
            PIPENV_VENV_IN_PROJECT=1 \
            pipenv install -d
          workingDirectory: 'app/worker/'

    
